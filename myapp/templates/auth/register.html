{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="hero min-h-[calc(100vh-4rem)]">
    <div class="hero-content flex-col lg:flex-row-reverse">
        <div class="text-center lg:text-left lg:ml-8">
            <h1 class="text-5xl font-bold">Create Account!</h1>
            <p class="py-6">Join Kanaka Application Tracking System to help streamline the hiring process and manage applicants effectively.</p>
        </div>
        <div class="card flex-shrink-0 w-full max-w-sm shadow-2xl bg-base-100">
            <form method="POST" action="{{ url_for('auth.handle_register') }}" class="card-body">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Name <span class="text-error">*</span></span>
                    </label>
                    <label class="input validator">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </g>
                        </svg>
                        <input
                            type="text"
                            name="name"
                            required
                            placeholder="Enter name"
                            pattern="[A-Za-z\s]{2,50}"
                            minlength="2"
                            maxlength="50"
                            title="Please enter a valid name"
                            value="{{ form_data.name if form_data else '' }}"
                        />
                    </label>
                    <p class="validator-hint hidden">
                        Please enter a valid name
                    </p>
                </div>
                
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Username <span class="text-error">*</span></span>
                    </label>
                    <label class="input validator">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </g>
                        </svg>
                        <input
                            type="text"
                            name="username"
                            required
                            placeholder="Enter username"
                            pattern="[A-Za-z][A-Za-z0-9\-._]*"
                            minlength="3"
                            maxlength="30"
                            title="Username must be 3-30 characters, start with a letter, and contain only letters, numbers, dots, underscores or dashes"
                            value="{{ form_data.username if form_data else '' }}"
                        />
                    </label>
                    <p class="validator-hint hidden">
                        Username: 3-50 characters, start with a letter
                        <br />Only letters, numbers, dots, underscores or dashes allowed
                    </p>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Email <span class="text-error">*</span></span>
                    </label>
                    <label class="input validator">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </g>
                        </svg>
                        <input
                            type="email"
                            name="email"
                            required
                            placeholder="Enter email"
                            pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                            title="Please enter a valid email address"
                            value="{{ form_data.email if form_data else '' }}"
                        />
                    </label>
                    <p class="validator-hint hidden">
                        Enter a valid email address
                    </p>
                </div>

                <div class="form-control relative mb-4">
                    <label class="label">
                        <span class="label-text">Password <span class="text-error">*</span></span>
                    </label>
                    <label class="input validator relative w-full">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                <path d="M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z"></path>
                                <circle cx="16.5" cy="7.5" r=".5" fill="currentColor"></circle>
                            </g>
                        </svg>
                        <input
                            type="password"
                            name="password"
                            id="myInput1"
                            required
                            placeholder="Password"
                            minlength="8"
                            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                            title="Must be more than 8 characters, including number, lowercase letter, uppercase letter"
                        />
                        <button type="button" onclick="togglePassword1()" class="absolute right-3 top-1/2 -translate-y-1/2">
                            <svg id="eyeIcon1" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.458 12C3.732 7.943 7.523 5 12 5
                                c4.477 0 8.268 2.943 9.542 7
                                -1.274 4.057-5.065 7-9.542 7
                                -4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </label>
                    <p class="validator-hint hidden">
                        Must be more than 8 characters, including
                        <br />At least one number
                        <br />At least one lowercase letter
                        <br />At least one uppercase letter
                    </p>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Confirm Password <span class="text-error">*</span></span>
                    </label>
                    <label class="input validator  relative">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                <path d="M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z"></path>
                                <circle cx="16.5" cy="7.5" r=".5" fill="currentColor"></circle>
                            </g>
                        </svg>
                        <input
                            type="password"
                            name="confirm_password"
                            id="myInput2"
                            required
                            placeholder="Confirm password"
                            minlength="8"
                            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                            title="Must match the password above"
                        />
                        <button type="button" onclick="togglePassword2()" class="absolute right-3 top-1/2 -translate-y-1/2">
                            <svg id="eyeIcon2" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.458 12C3.732 7.943 7.523 5 12 5
                                c4.477 0 8.268 2.943 9.542 7
                                -1.274 4.057-5.065 7-9.542 7
                                -4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </label>
                    <p class="validator-hint hidden">
                        Must match the password above
                    </p>
                </div>

                <div class="form-control mt-6">
                    <button type="submit" class="btn btn-primary">Register</button>
                </div>
            </form>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} mx-4 mb-4">
                            <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function togglePassword1() {
        const input = document.getElementById("myInput1");
        const icon = document.getElementById("eyeIcon1");

        if (input.type === "password") {
            input.type = "text";
            icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7
                      a9.956 9.956 0 012.042-3.362m1.644-1.644
                      A9.953 9.953 0 0112 5c4.477 0 8.268 2.943 9.542 7
                      a9.973 9.973 0 01-4.126 5.317M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 3l18 18" />
            `;
        } else {
            input.type = "password";
            icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5
                      c4.477 0 8.268 2.943 9.542 7
                      -1.274 4.057-5.065 7-9.542 7
                      -4.477 0-8.268-2.943-9.542-7z" />
            `;
        }
    }

    function togglePassword2() {
        const input = document.getElementById("myInput2");
        const icon = document.getElementById("eyeIcon2");

        if (input.type === "password") {
            input.type = "text";
            icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7
                      a9.956 9.956 0 012.042-3.362m1.644-1.644
                      A9.953 9.953 0 0112 5c4.477 0 8.268 2.943 9.542 7
                      a9.973 9.973 0 01-4.126 5.317M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 3l18 18" />
            `;
        } else {
            input.type = "password";
            icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5
                      c4.477 0 8.268 2.943 9.542 7
                      -1.274 4.057-5.065 7-9.542 7
                      -4.477 0-8.268-2.943-9.542-7z" />
            `;
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            document.querySelectorAll('.alert').forEach(function(alert) {
                alert.style.transition = "opacity 0.5s";
                alert.style.opacity = 0;
                setTimeout(function() { alert.style.display = "none"; }, 500);
            });
        }, 10000);
    });
</script>
{% endblock %}